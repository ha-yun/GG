<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‹¤ì‹œê°„ ì±„íŒ…</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>ìŠ¤íƒ€-íŒ¬ ì‹¤ì‹œê°„ ì±„íŒ…</h2>
<div id="chatBox"></div>
<input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
<button onclick="sendMessage()">ì „ì†¡</button>

<script>
  let socket = new SockJS('/ws');
  let stompClient = Stomp.over(socket);

  stompClient.connect({}, function (frame) {
    console.log("ì›¹ì†Œì¼“ Connected: " + frame);

    // ğŸ”¹ ê¸°ì¡´ ì±„íŒ… ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("/api/chat/history")
            .then(response => response.json())
            .then(messages => {
              let chatBox = document.getElementById("chatBox");
              messages.forEach(msg => {
                let newMessage = document.createElement("p");
                newMessage.textContent = msg;
                chatBox.appendChild(newMessage);
              });
            });

    // ì‹¤ì‹œê°„ ë©”ì„¸ì§€ ìˆ˜ì‹ 
    stompClient.subscribe('/topic/messages', function (message) {
      console.log("ğŸ“© ë°›ì€ ë©”ì‹œì§€:", message.body);
      let chatBox = document.getElementById("chatBox");
      let newMessage = document.createElement("p");
      newMessage.textContent = message.body;
      chatBox.appendChild(newMessage);
    });
  },function (error) {
    console.log("âŒ ì›¹ì†Œì¼“ ì—°ê²° ì‹¤íŒ¨!",error);
  });

  function sendMessage() {
    let msg = document.getElementById("messageInput").value;
    console.log("ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡:", msg);
    stompClient.send("/app/send", {}, msg);
    document.getElementById("messageInput").value = ""; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  }
</script>
</body>
</html>
