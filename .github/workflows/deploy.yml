name: Docker, Ci/Cd

on:
  push:
    branches:
      - koyeb-deploy

jobs:
  docker-cicd:
    runs-on: ubuntu-latest
    timeout-minutes: 15  # 빌드 타임아웃을 15분으로 증가
    steps:
      - name: 소스코드 체크아웃
        uses: actions/checkout@v4
        with:
          ref: deploy-test  # 정확한 브랜치 체크아웃!
  
      - name: 현재 상황 체크
        run: |
            pwd
            ls

      - name: Install Docker Compose
        run: |
          sudo apt-get update
          sudo apt-get install -y docker-compose

      - name: 도커허브 로그인
        run: echo "${{ secrets.DOCKERHUB_PASSWORD }}" | docker login -u "${{ secrets.DOCKERHUB_USERNAME }}" --password-stdin

      - name: 도커 허브에 이미지 빌드
        run: docker-compose build

      - name: 도커 허브에 이미지 빌드 확인
        run: docker images

      - name: 도커 허브에 이미지 푸시
        run: docker-compose push